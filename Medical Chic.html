<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ’Š APOTHECARY | THE LOVE CURE</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono&family=Inter:wght@300;600;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --medical-white: #ffffff;
            --medical-gray: #f2f2f7;
            --heart-red: #ff3b30;
            --capsule-blue: #007aff;
            --text-dark: #1c1c1e;
            --thermal-ink: #2c2c2e;
            --font-mono: 'Space Mono', monospace;
            --font-sans: 'Inter', sans-serif;
            --pulse-speed: 2s;
            --bg-color: var(--medical-gray);
            --grid-color: #d1d1d6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--text-dark);
            font-family: var(--font-sans);
            min-height: 100vh;
            width: 100vw;
            overflow-x: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 1.5s ease; /* Smooth Pink Transition */
        }

        /* --- HEARTBEAT ANIMATION --- */
        @keyframes heartbeat {
            0% { transform: scale(1); }
            10% { transform: scale(1.015); filter: brightness(1.05); }
            20% { transform: scale(1); }
            30% { transform: scale(1.008); }
            40% { transform: scale(1); }
        }

        .pulse-active {
            animation: heartbeat var(--pulse-speed) infinite ease-in-out;
        }

        .lab-grid {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: -1;
            opacity: 0.5;
            transition: background-image 1.5s ease;
        }

        /* --- HUB LAYOUT --- */
        .apothecary-hub {
            width: 95vw;
            height: 90vh;
            max-width: 1400px;
            background: var(--medical-white);
            border-radius: 40px;
            box-shadow: 0 40px 100px rgba(0,0,0,0.08);
            display: grid;
            grid-template-columns: 350px 1fr 320px;
            overflow: hidden;
            border: 1px solid #e5e5ea;
            position: relative;
            transition: box-shadow 1s ease;
        }

        .apothecary-hub.complete {
            box-shadow: 0 0 80px rgba(255, 182, 193, 0.6);
        }

        .rx-sidebar {
            background: #fafafa;
            border-right: 1px solid #efefef;
            padding: 40px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .rx-label {
            font-family: var(--font-mono);
            font-size: 0.65rem;
            color: #8e8e93;
            text-transform: uppercase;
            letter-spacing: 2.5px;
        }

        .tablet-selector {
            padding: 20px;
            background: #fff;
            border: 1px solid #e5e5ea;
            border-radius: 20px;
            cursor: pointer;
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .tablet-selector:hover { border-color: var(--heart-red); transform: translateX(5px); }

        .vial-view {
            position: relative;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* --- SCANNER --- */
        .scanner-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: rgba(255, 59, 48, 0.4);
            box-shadow: 0 0 15px var(--heart-red);
            top: -10%;
            left: 0;
            z-index: 5;
            pointer-events: none;
            display: none;
        }

        .scanning .scanner-line {
            display: block;
            animation: scanMove 3s linear infinite;
        }

        @keyframes scanMove {
            0% { top: 20%; }
            100% { top: 80%; }
        }

        #vialCanvas {
            width: 420px;
            height: 550px;
            border: 12px solid #f2f2f7;
            border-radius: 40px 40px 180px 180px;
            background: linear-gradient(to bottom, rgba(242, 242, 247, 0.3), rgba(255, 255, 255, 0.8));
            box-shadow: inset 0 20px 40px rgba(0,0,0,0.03);
            transition: border-color 1s ease;
        }

        /* --- PRINTER --- */
        .label-printer {
            background: #fff;
            border: 1px solid #d1d1d6;
            padding: 20px;
            min-height: 350px;
            font-family: var(--font-mono);
            font-size: 0.75rem;
            line-height: 1.6;
            color: var(--thermal-ink);
            overflow: hidden;
            position: relative;
        }

        .print-jitter { animation: jitter 0.1s infinite; }
        @keyframes jitter { 0% { transform: translateY(0); } 50% { transform: translateY(1px); } }

        .reveal-modal {
            position: fixed;
            inset: 0;
            background: #fff0f5; /* Lavender Blush / Soft Pink */
            z-index: 1000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        .reveal-modal.active { display: flex; animation: curtainUp 0.8s cubic-bezier(0.19, 1, 0.22, 1); }
        @keyframes curtainUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        /* --- MOBILE --- */
        @media (max-width: 1024px) {
            body { height: auto; overflow-y: auto; padding: 20px 0; }
            .apothecary-hub { grid-template-columns: 1fr; height: auto; width: 92vw; border-radius: 25px; }
            .rx-sidebar, .effect-sidebar { border: none; padding: 30px; }
            .vial-view { padding: 60px 10px; }
            #vialCanvas { width: 100% !important; max-width: 350px; height: auto !important; aspect-ratio: 420/550; }
        }
    </style>
</head>
<body>

    <div class="lab-grid" id="grid"></div>

    <div class="apothecary-hub" id="hub">
        <aside class="rx-sidebar">
            <div>
                <p class="rx-label">Biometric Sync</p>
                <h2 style="font-weight: 900; letter-spacing: -1.5px; font-size: 1.8rem; color: var(--heart-red);">JOTHIESH'S FAV</h2>
            </div>

            <p class="rx-label">Dispense Components</p>
            <div class="tablet-selector" onclick="dispense('red')">
                <div style="width: 35px; height: 18px; border-radius: 10px; background: var(--heart-red);"></div>
                <div>
                    <p style="font-weight: 700; font-size: 0.85rem;">AMOR-PHASE</p>
                    <p style="font-size: 0.6rem; color: #8e8e93;">High Potency Love</p>
                </div>
            </div>

            <div class="tablet-selector" onclick="dispense('blue')">
                <div style="width: 35px; height: 18px; border-radius: 10px; background: var(--capsule-blue);"></div>
                <div>
                    <p style="font-weight: 700; font-size: 0.85rem;">LOYAL-SYNC</p>
                    <p style="font-size: 0.6rem; color: #8e8e93;">Compatibility Molecule</p>
                </div>
            </div>

            <div style="margin-top: auto; padding: 20px; background: #f2f2f7; border-radius: 20px; border: 1px dashed #d1d1d6;">
                <p class="rx-label">Protocol</p>
                <p style="font-size: 0.7rem; line-height: 1.4;">"Agitation increases resonance. Achieve 100% for full molecular sync."</p>
            </div>
        </aside>

        <main class="vial-view" id="vialView">
            <div class="scanner-line"></div>
            <canvas id="vialCanvas"></canvas>
            
            <div style="position: absolute; bottom: 40px; text-align: center;">
                <p class="rx-label">Sync Resonance</p>
                <h2 id="resonanceHud" style="font-weight: 900; font-size: 2.5rem; font-family: var(--font-mono);">0%</h2>
                <p id="heartStatus" style="font-size: 0.6rem; font-family: var(--font-mono); color: var(--heart-red); opacity: 0;">ðŸ’“ HEARTBEAT DETECTED</p>
            </div>
        </main>

        <aside class="effect-sidebar">
            <p class="rx-label">Thermal Report</p>
            <div class="label-printer" id="printer">
                <div id="printerContent">
                    <p>> SYSTEM: ONLINE</p>
                    <p>> AWAITING SAMPLES...</p>
                </div>
            </div>
            <div style="margin-top: 20px; font-family: var(--font-mono); font-size: 0.55rem; color: #aeaeb2;">
                REF_ID: 2026-VAL-SYNC<br>
                ENCRYPTION: AES-HEART
            </div>
        </aside>
    </div>

    <div id="finalModal" class="reveal-modal">
        <p class="rx-label" style="color: var(--heart-red); margin-bottom: 20px;">Diagnosis Complete</p>
        <h1 style="font-size: clamp(2rem, 8vw, 4.5rem); font-weight: 900; letter-spacing: -2px;">You are my only cure.</h1>
        <p style="max-width: 500px; line-height: 1.6; color: #d63384; font-weight: 600; margin-top: 20px;">Diagnosis: Perfect compatibility detected. No other treatment needed forever.</p>
        <button class="tablet-selector" style="margin-top: 40px; background: var(--heart-red); color: white; border: none; padding: 20px 40px;" onclick="location.reload()">RE-ISSUE RX</button>
    </div>

    <script>
        const canvas = document.getElementById('vialCanvas');
        const ctx = canvas.getContext('2d');
        const resonanceHud = document.getElementById('resonanceHud');
        const printerContent = document.getElementById('printerContent');
        const printer = document.getElementById('printer');
        const vialView = document.getElementById('vialView');
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        let pills = [];
        let bubbles = [];
        let resonance = 0;
        let isComplete = false;

        const observations = [
            "Poetic tendencies detected.",
            "Syncing heartbeats...",
            "Butterfly migration high.",
            "Daydreaming priority: MAX.",
            "Oxytocin levels peaking.",
            "Result: Infinite Bond."
        ];

        function playHeartbeat() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const now = audioCtx.currentTime;
            const thump = (freq, time) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.frequency.setValueAtTime(freq, time);
                gain.gain.setValueAtTime(0.4, time);
                gain.gain.exponentialRampToValueAtTime(0.001, time + 0.1);
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.start(time); osc.stop(time + 0.1);
            };
            thump(60, now); thump(50, now + 0.15);
        }

        function handlePulse() {
            if (resonance > 5 && !isComplete) {
                playHeartbeat();
                document.body.classList.add('pulse-active');
                document.getElementById('heartStatus').style.opacity = 1;
                const speed = Math.max(0.4, 2 - (resonance / 60));
                document.documentElement.style.setProperty('--pulse-speed', speed + 's');
            }
            const interval = Math.max(400, 2000 - (resonance * 18));
            if (!isComplete) setTimeout(handlePulse, interval);
        }

        class Bubble {
            constructor(x, y) {
                this.x = x; this.y = y;
                this.r = Math.random() * 3 + 1;
                this.v = Math.random() * 2 + 1;
                this.life = 1.0;
            }
            update() { this.y -= this.v; this.life -= 0.02; }
            draw() {
                ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, Math.PI*2);
                ctx.fillStyle = `rgba(255, 182, 193, ${this.life * 0.6})`; ctx.fill();
            }
        }

        class Pill {
            constructor(color) {
                this.x = 210 + (Math.random()-0.5)*80; this.y = 40;
                this.color = color === 'red' ? '#ff3b30' : '#007aff';
                this.vx = (Math.random()-0.5)*15; this.vy = 5;
                this.angle = Math.random()*Math.PI;
            }
            update() {
                this.vy += 0.5; this.x += this.vx; this.y += this.vy; this.angle += this.vx * 0.05;
                if (this.x < 35 || this.x > canvas.width - 35) { this.vx *= -0.6; this.x = this.x < 35 ? 35 : canvas.width - 35; }
                if (this.y > canvas.height - 40) { 
                    this.vy *= -0.4; this.y = canvas.height - 40; 
                    if(Math.abs(this.vx) > 1) bubbles.push(new Bubble(this.x, this.y));
                    if(!isComplete) addResonance(0.5);
                }
            }
            draw() {
                ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(this.angle);
                ctx.fillStyle = this.color; ctx.beginPath();
                ctx.roundRect(-18, -9, 36, 18, 10); ctx.fill();
                ctx.fillStyle = "rgba(255,255,255,0.2)"; ctx.fillRect(-10, -5, 10, 3);
                ctx.restore();
            }
        }

        function addResonance(amt) {
            resonance = Math.min(resonance + amt, 100);
            resonanceHud.innerText = Math.floor(resonance) + "%";

            // Pink Transition Logic
            const pinkIntensity = resonance / 100;
            const bgR = Math.floor(242 + (pinkIntensity * 13)); // Move toward #FFF0F5
            const bgG = Math.floor(242 - (pinkIntensity * 2));
            const bgB = Math.floor(247 - (pinkIntensity * 2));
            document.body.style.backgroundColor = `rgb(${bgR}, ${bgG}, ${bgB})`;
            
            if(resonance > 80) {
                document.getElementById('grid').style.setProperty('--grid-color', '#ffb6c1');
                canvas.style.borderColor = '#ffb6c1';
            }

            if(Math.floor(resonance) % 20 === 0 && resonance > 5) printReport();
            
            if(resonance >= 100 && !isComplete) {
                isComplete = true;
                document.getElementById('hub').classList.add('complete');
                setTimeout(() => document.getElementById('finalModal').classList.add('active'), 1000);
            }
        }

        function printReport() {
            const p = document.createElement('p');
            p.innerText = `> ${observations[Math.floor(Math.random()*observations.length)]}`;
            printerContent.prepend(p);
            printer.classList.add('print-jitter');
            setTimeout(() => printer.classList.remove('print-jitter'), 500);
        }

        function dispense(type) {
            if(isComplete) return;
            if(pills.length === 0) handlePulse();
            pills.push(new Pill(type));
            vialView.classList.add('scanning');
            setTimeout(() => vialView.classList.remove('scanning'), 2000);
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            bubbles = bubbles.filter(b => b.life > 0);
            bubbles.forEach(b => { b.update(); b.draw(); });
            pills.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animate);
        }

        function agitate(x, y) {
            canvas.style.transform = `scale(1.02) rotate(${(Math.random()-0.5)*2}deg)`;
            setTimeout(() => canvas.style.transform = `scale(1) rotate(0deg)`, 50);
            pills.forEach(p => {
                const dx = x - p.x; const dy = y - p.y;
                if(Math.sqrt(dx*dx + dy*dy) < 120) { p.vx += (Math.random()-0.5)*20; p.vy -= 10; addResonance(0.1); }
            });
        }

        window.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            agitate(e.clientX - rect.left, e.clientY - rect.top);
        });

        window.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            agitate(touch.clientX - rect.left, touch.clientY - rect.top);
        }, { passive: false });

        canvas.width = 420;
        canvas.height = 550;
        animate();
    </script>
</body>
</html>
